@page
@model IndexModel
@{
    ViewData["Title"] = "Tổng quan";
    var culture = new System.Globalization.CultureInfo("vi-VN");
}

<!-- Thư viện Chart.js để vẽ biểu đồ -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<div class="max-w-7xl mx-auto py-8 px-4 sm:px-6 lg:px-8 space-y-8">
    
    <!-- 1. Header & Welcome -->
    <div class="flex flex-col md:flex-row md:items-end justify-between gap-4 border-b border-slate-200 pb-6">
        <div>
            <h1 class="text-3xl font-bold text-slate-900 tracking-tight">Tổng quan hệ thống</h1>
            <p class="text-slate-500 mt-2 text-base">Chào mừng trở lại! Dưới đây là báo cáo hoạt động hôm nay.</p>
        </div>
        <div class="flex items-center gap-3 bg-white px-4 py-2 rounded-lg border border-slate-200 shadow-sm">
            <div class="p-1.5 bg-indigo-50 text-indigo-600 rounded">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z" /></svg>
            </div>
            Hôm nay:
            <div class="text-sm text-slate-400">
            @DateTime.Now.ToString("dd/MM/yyyy")
        </div>
        </div>
    </div>

    <!-- 2. Stats Grid (Thống kê nhanh) -->
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
        
        <!-- Card 1: Tổng loại cá -->
        <div class="bg-white p-6 rounded-2xl border border-slate-200 shadow-[0_2px_10px_-3px_rgba(6,81,237,0.1)] hover:shadow-lg transition-all group">
            <div class="flex justify-between items-start">
                <div>
                    <p class="text-xs font-bold text-slate-400 uppercase tracking-wider mb-1">Tổng Loại Cá</p>
                    <h3 class="text-3xl font-bold text-slate-800 group-hover:text-indigo-600 transition-colors">@Model.TotalFishTypesCount</h3>
                    <p class="text-xs text-slate-500 mt-1">loại cá đang quản lý</p>
                </div>
                
                <div class="p-3 bg-indigo-50 text-indigo-600 rounded-xl group-hover:scale-110 transition-transform">
            <svg class="h-6 w-6 shrink-0" fill="currentColor" viewBox="0 0 640 512"><path d="M212.5 205.5C251.7 172.5 304.6 144 368 144C431.4 144 484.3 172.5 523.5 205.5C562.6 238.5 590.4 277.9 604.5 305.3C609.2 314.5 609.2 325.4 604.5 334.6C590.4 362 562.6 401.4 523.5 434.4C484.3 467.5 431.5 495.9 368 495.9C304.5 495.9 251.7 467.4 212.5 434.4C196.3 420.7 182 405.9 169.8 391.3L80.1 443.6C67.6 450.9 51.7 448.9 41.4 438.7C31.1 428.5 29 412.7 36.1 400.1L82 320L36.2 239.9C29 227.3 31.2 211.5 41.5 201.3C51.8 191.1 67.6 189.1 80.2 196.4L169.9 248.7C182.1 234.1 196.4 219.3 212.6 205.6zM480 320C480 302.3 465.7 288 448 288C430.3 288 416 302.3 416 320C416 337.7 430.3 352 448 352C465.7 352 480 337.7 480 320z" /></svg>
                </div>
            </div>
        </div>

        <!-- Card 2: Sản lượng hôm nay (Real Data) -->
        <div class="bg-white p-6 rounded-2xl border border-slate-200 shadow-[0_2px_10px_-3px_rgba(6,81,237,0.1)] hover:shadow-lg transition-all group">
            <div class="flex justify-between items-start">
                <div>
                    <p class="text-xs font-bold text-slate-400 uppercase tracking-wider mb-1">Sản lượng hôm nay</p>
                    <h3 class="text-3xl font-bold text-slate-800 group-hover:text-emerald-600 transition-colors">
                        @Model.TotalWeightToday.ToString("N0") <span class="text-sm font-normal text-slate-400">kg</span>
                    </h3>
                    <p class="text-xs @(Model.WeightGrowth >= 0 ? "text-emerald-600" : "text-red-500") mt-1 flex items-center font-medium">
                        @if (Model.WeightGrowth >= 0) {
                             <svg class="w-3 h-3 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7h8m0 0v8m0-8l-8 8-4-4-6 6"></path></svg>
                             <span>+@Model.WeightGrowth.ToString("0.0")% so với lần trước</span>
                        } else {
                             <svg class="w-3 h-3 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 17h8m0 0V9m0 8l-8-8-4 4-6-6"></path></svg>
                             <span>@Model.WeightGrowth.ToString("0.0")% so với lần trước</span>
                        }
                    </p>
                </div>
                <div class="p-3 bg-emerald-50 text-emerald-600 rounded-xl group-hover:scale-110 transition-transform">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 6l3 1m0 0l-3 9a5.002 5.002 0 006.001 0M6 7l3 9M6 7l6-2m6 2l3-1m-3 1l-3 9a5.002 5.002 0 006.001 0M18 7l3 9m-3-9l-6-2m0-2v2m0 16V5m0 16H9m3 0h3" /></svg>
                </div>
            </div>
        </div>

        <!-- Card 3: Chi phí lương (Real Data) -->
        <div class="bg-white p-6 rounded-2xl border border-slate-200 shadow-[0_2px_10px_-3px_rgba(6,81,237,0.1)] hover:shadow-lg transition-all group">
            <div class="flex justify-between items-start">
                <div>
                    <p class="text-xs font-bold text-slate-400 uppercase tracking-wider mb-1">Lương ước tính</p>
                    <h3 class="text-3xl font-bold text-slate-800 group-hover:text-amber-600 transition-colors">
                        @((Model.TotalSalaryMonth / 1000000).ToString("N1")) <span class="text-sm font-normal text-slate-400">triệu</span>
                    </h3>
                    <p class="text-xs text-slate-500 mt-1">Chu kỳ tính: Tháng này</p>
                </div>
                <div class="p-3 bg-amber-50 text-amber-600 rounded-xl group-hover:scale-110 transition-transform">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>
                </div>
            </div>
        </div>

        <!-- Card 4: Tổ chế biến (Real Data) -->
        <div class="bg-white p-6 rounded-2xl border border-slate-200 shadow-[0_2px_10px_-3px_rgba(6,81,237,0.1)] hover:shadow-lg transition-all group">
            <div class="flex justify-between items-start">
                <div>
                    <p class="text-xs font-bold text-slate-400 uppercase tracking-wider mb-1">Tổ chế biến</p>
                    <h3 class="text-3xl font-bold text-slate-800 group-hover:text-blue-600 transition-colors">
                        @Model.ActiveUnitsCount / @Model.TotalUnitsCount
                    </h3>
                    <p class="text-xs text-green-600 mt-1">Đang hoạt động</p>
                </div>
                <div class="p-3 bg-blue-50 text-blue-600 rounded-xl group-hover:scale-110 transition-transform">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z" /></svg>
                </div>
            </div>
        </div>
    </div>

    <!-- 3. Main Content: Chart & Quick Actions -->
    <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
        
        <!-- Left Column: Biểu đồ (Chiếm 2/3) -->
        <div class="lg:col-span-2 bg-white p-6 rounded-2xl border border-slate-200 shadow-sm">
            <div class="flex justify-between items-center mb-6">
                <!-- Đã sửa thành 10 ngày -->
                <h3 class="text-lg font-bold text-slate-800">Biểu đồ sản lượng (10 ngày)</h3>
                <!-- Đã sửa AddDays(-9) để hiển thị đúng khoảng 10 ngày -->
                <span class="text-xs text-slate-500 bg-slate-100 px-2 py-1 rounded">@DateTime.Now.AddDays(-9).ToString("dd/MM") - @DateTime.Now.ToString("dd/MM")</span>
            </div>
            <div class="relative h-72 w-full">
                <!-- Thêm data attribute để truyền dữ liệu vào JS -->
                <canvas id="productionChart" 
                        data-labels='@Json.Serialize(Model.ChartLabels)' 
                        data-values='@Json.Serialize(Model.ChartValues)'>
                </canvas>
            </div>
        </div>

        <!-- Right Col Truy cập nhanh -->
        <div class="space-y-6">
            
            <!-- Quick Actions -->
            <div class="bg-gradient-to-br from-indigo-600 to-blue-700 rounded-2xl p-6 text-white shadow-lg">
                <h3 class="text-lg font-bold mb-4">Truy cập nhanh</h3>
                <div class="grid grid-cols-2 gap-3">
                    <a href="/Fish/AddFishType" class="flex flex-col items-center justify-center p-3 bg-white/10 hover:bg-white/20 rounded-xl transition backdrop-blur-sm cursor-pointer border border-white/10">
                        <svg class="w-6 h-6 mb-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"></path></svg>
                        <span class="text-xs font-semibold">Thêm Cá</span>
                    </a>
                    <a href="/ProcessingSetupModel" class="flex flex-col items-center justify-center p-3 bg-white/10 hover:bg-white/20 rounded-xl transition backdrop-blur-sm cursor-pointer border border-white/10">
                        <svg class="w-6 h-6 mb-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 7h6m0 10v-3m-3 3h.01M9 17h.01M9 14h.01M12 14h.01M15 11h.01M12 11h.01M9 11h.01M7 21h10a2 2 0 002-2V5a2 2 0 00-2-2H7a2 2 0 00-2 2v14a2 2 0 002 2z"></path></svg>
                        <span class="text-xs font-semibold">Tính Lương</span>
                    </a>
                    <a href="/Fish" class="flex flex-col items-center justify-center p-3 bg-white/10 hover:bg-white/20 rounded-xl transition backdrop-blur-sm cursor-pointer border border-white/10">
                        <svg class="w-6 h-6 mb-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 10h16M4 14h16M4 18h16"></path></svg>
                        <span class="text-xs font-semibold">QL ds Cá</span>
                    </a>
                    <a href="/Features/ReceiptList" class="flex flex-col items-center justify-center p-3 bg-white/10 hover:bg-white/20 rounded-xl transition backdrop-blur-sm cursor-pointer border border-white/10">
                        <svg class="w-6 h-6 mb-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 17v-2m3 2v-4m3 4v-6m2 10H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path></svg>
                        <span class="text-xs font-semibold">Báo Cáo Tổng</span>
                    </a>
                </div>
            </div>

            <!-- Recent Activity List (Real Data) -->
            <div class="bg-white p-5 rounded-2xl border border-slate-200 shadow-sm">
                <h3 class="text-sm font-bold text-slate-700 uppercase tracking-wide mb-4">Giao dịch gần đây</h3>
                <div class="space-y-4">
                    @if (Model.RecentActivities != null && Model.RecentActivities.Any())
                    {
                        foreach (var item in Model.RecentActivities.Take(1))
                        {
                            <div class="flex items-center gap-3">
                                <div class="w-10 h-10 rounded-full bg-blue-50 flex items-center justify-center text-blue-600 text-xs font-bold shrink-0">
                                    T@(item.UnitId)
                                </div>
                                <div class="flex-1 min-w-0">
                                    <h4 class="text-sm font-semibold text-slate-800 truncate">Nhập liệu tổ @item.UnitId</h4>
                                    <p class="text-xs text-slate-500 truncate">
                                        Ngày: @item.Date.ToString("dd/MM") • với @item.TotalQuantityProcessed.ToString("N0") kg
                                    </p>
                                </div>
                                <span class="text-xs font-bold text-emerald-600 shrink-0">
                                    + @item.SalaryPayment.ToString("#,##0") nghìn
                                </span>
                            </div>
                        }
                    }
                    else
                    {
                        <p class="text-sm text-slate-400 italic text-center py-4">Chưa có hoạt động nào trong tháng</p>
                    }
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        const ctx = document.getElementById('productionChart').getContext('2d');
        const canvas = document.getElementById('productionChart');

        const labels = JSON.parse(canvas.dataset.labels);
        const dataValues = JSON.parse(canvas.dataset.values);

        new Chart(ctx, {
            type: 'line',
            data: {
                labels: labels,
                datasets: [{
                    label: 'Sản lượng (kg)',
                    data: dataValues,
                    borderColor: '#4f46e5', // Indigo-600
                    backgroundColor: 'rgba(79, 70, 229, 0.1)',
                    borderWidth: 2,
                    tension: 0.4,
                    fill: true,
                    pointBackgroundColor: '#ffffff',
                    pointBorderColor: '#4f46e5',
                    pointRadius: 4,
                    pointHoverRadius: 6
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: { display: false },
                    tooltip: {
                        mode: 'index',
                        intersect: false,
                        backgroundColor: 'rgba(15, 23, 42, 0.9)',
                        titleColor: '#fff',
                        bodyColor: '#cbd5e1',
                        borderColor: 'rgba(255,255,255,0.1)',
                        borderWidth: 1
                    }
                },
                scales: {
                    y: {
                        beginAtZero: true,
                        grid: { color: '#f1f5f9', borderDash: [5, 5] },
                        ticks: { color: '#94a3b8' }
                    },
                    x: {
                        grid: { display: false },
                        ticks: { color: '#64748b' }
                    }
                }
            }
        });
    });
</script>